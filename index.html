<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vintage Letter Reveal</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Special+Elite&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root {
        --paper-bg: #e6d3ae;
        --paper-bg-2: #d9bd8b;
        --paper-ink: #2f2418;
        --paper-accent: #70502d;
        --burn: #4a2f17;
        --outer-bg: #5f4126;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        color: var(--paper-ink);
        font-family: "Playfair Display", Georgia, serif;
        min-height: 100vh;
        background-color: var(--outer-bg);
        background-image:
          radial-gradient(circle at 12% 20%, rgba(255, 240, 210, 0.2) 0 16%, transparent 17%),
          radial-gradient(circle at 78% 22%, rgba(34, 22, 12, 0.2) 0 22%, transparent 23%),
          radial-gradient(circle at 30% 78%, rgba(255, 239, 206, 0.15) 0 18%, transparent 19%),
          radial-gradient(circle at 90% 74%, rgba(28, 17, 10, 0.17) 0 19%, transparent 20%),
          linear-gradient(145deg, #6a482b 0%, #5c3f25 45%, #4e341f 100%);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        opacity: 0.18;
        background-image:
          repeating-linear-gradient(
            30deg,
            rgba(255, 255, 255, 0.16) 0,
            rgba(255, 255, 255, 0.16) 1px,
            transparent 1px,
            transparent 7px
          ),
          repeating-linear-gradient(
            -35deg,
            rgba(0, 0, 0, 0.12) 0,
            rgba(0, 0, 0, 0.12) 1px,
            transparent 1px,
            transparent 8px
          );
      }

      .parchment {
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(76, 46, 24, 0.5);
        border-radius: 16px;
        background:
          radial-gradient(circle at 18% 16%, rgba(255, 245, 220, 0.4) 0%, transparent 30%),
          radial-gradient(circle at 82% 85%, rgba(175, 130, 70, 0.2) 0%, transparent 34%),
          linear-gradient(180deg, var(--paper-bg) 0%, var(--paper-bg-2) 100%);
        box-shadow:
          0 28px 45px rgba(0, 0, 0, 0.35),
          inset 0 0 0 2px rgba(255, 238, 204, 0.3),
          inset 0 0 90px rgba(95, 58, 28, 0.24);
      }

      .parchment::before {
        content: "";
        position: absolute;
        inset: -14px;
        z-index: -1;
        border-radius: 22px;
        background:
          radial-gradient(circle at 5% 7%, rgba(59, 33, 17, 0.72), transparent 26%),
          radial-gradient(circle at 94% 8%, rgba(59, 33, 17, 0.68), transparent 26%),
          radial-gradient(circle at 93% 92%, rgba(59, 33, 17, 0.74), transparent 26%),
          radial-gradient(circle at 7% 94%, rgba(59, 33, 17, 0.7), transparent 26%);
        filter: blur(3px);
      }

      .burn-frame {
        pointer-events: none;
        position: absolute;
        inset: 0;
        border-radius: 16px;
        box-shadow:
          inset 0 0 0 1px rgba(255, 229, 180, 0.28),
          inset 0 0 34px rgba(56, 30, 15, 0.45),
          inset 0 0 90px rgba(65, 36, 17, 0.33);
      }

      .torn {
        position: absolute;
        left: -6%;
        width: 112%;
        height: 40px;
        opacity: 0.46;
        background:
          linear-gradient(180deg, rgba(93, 60, 30, 0.18), rgba(93, 60, 30, 0.42)),
          repeating-linear-gradient(
            90deg,
            rgba(255, 240, 208, 0.3) 0,
            rgba(255, 240, 208, 0.3) 6px,
            rgba(78, 48, 24, 0.24) 6px,
            rgba(78, 48, 24, 0.24) 13px
          );
      }

      .torn.top {
        top: -2px;
        clip-path: polygon(0 0, 4% 40%, 8% 12%, 13% 45%, 18% 8%, 26% 47%, 33% 15%, 41% 50%, 50% 10%, 59% 48%, 66% 14%, 74% 45%, 82% 7%, 90% 44%, 96% 11%, 100% 45%, 100% 0);
      }

      .torn.bottom {
        bottom: -2px;
        transform: rotate(180deg);
        clip-path: polygon(0 0, 4% 40%, 8% 12%, 13% 45%, 18% 8%, 26% 47%, 33% 15%, 41% 50%, 50% 10%, 59% 48%, 66% 14%, 74% 45%, 82% 7%, 90% 44%, 96% 11%, 100% 45%, 100% 0);
      }

      .ornament {
        position: absolute;
        width: clamp(72px, 12vw, 140px);
        opacity: 0.28;
        fill: #7d5730;
        stroke: #4f341b;
        stroke-width: 1.2;
        pointer-events: none;
      }

      .ornament.left {
        top: 18px;
        left: 16px;
      }

      .ornament.right {
        bottom: 18px;
        right: 16px;
        transform: rotate(180deg);
      }

      .typewriter {
        font-family: "Special Elite", "Courier New", monospace;
        letter-spacing: 0.03em;
      }

      .reveal {
        transform-origin: top center;
        animation: unroll 0.95s cubic-bezier(0.17, 0.84, 0.44, 1) forwards;
      }

      @keyframes unroll {
        0% {
          opacity: 0;
          transform: perspective(800px) rotateX(-30deg) scaleY(0.35);
          filter: blur(2px);
        }
        75% {
          opacity: 1;
          transform: perspective(800px) rotateX(3deg) scaleY(1.02);
          filter: blur(0);
        }
        100% {
          opacity: 1;
          transform: perspective(800px) rotateX(0deg) scaleY(1);
        }
      }

      .soft-fade {
        animation: fadeIn 1.1s ease-out forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .muted-button {
        position: fixed;
        right: 0.85rem;
        top: 0.85rem;
        z-index: 30;
        border: 1px solid rgba(65, 37, 17, 0.65);
        border-radius: 999px;
        background: linear-gradient(180deg, rgba(239, 221, 187, 0.94), rgba(194, 155, 102, 0.9));
        color: #3e2815;
        font-family: "Special Elite", "Courier New", monospace;
        font-size: 0.78rem;
        padding: 0.46rem 0.8rem;
        box-shadow: 0 5px 14px rgba(0, 0, 0, 0.28);
        transition: opacity 0.25s ease, transform 0.25s ease;
      }

      .muted-button:hover {
        transform: translateY(-1px);
      }

      .hidden-until-auth {
        opacity: 0;
        pointer-events: none;
      }

      @media (max-width: 640px) {
        .muted-button {
          right: 0.7rem;
          top: 0.7rem;
        }
      }
    </style>
  </head>

  <body class="px-4 py-8 sm:px-6">
    <button id="muteToggle" class="muted-button hidden-until-auth" aria-pressed="false" aria-label="Mute background music">
      Mute
    </button>

    <main class="mx-auto flex min-h-[calc(100vh-4rem)] w-full max-w-5xl items-center justify-center">
      <section class="parchment w-full p-5 sm:p-8 lg:p-10">
        <div class="torn top"></div>
        <div class="torn bottom"></div>
        <div class="burn-frame"></div>

        <svg class="ornament left" viewBox="0 0 100 100" aria-hidden="true">
          <path d="M10 82c14-3 23-11 27-24 4-13 11-23 22-28 8-4 18-5 31-2-11 5-19 13-24 24-4 8-6 17-14 22-7 5-17 8-30 8-5 0-9 0-12 0z"></path>
          <path d="M18 70c10-8 18-20 23-34 3 9 8 16 15 20-7 3-13 8-18 14-6 7-12 7-20 0z"></path>
        </svg>

        <svg class="ornament right" viewBox="0 0 100 100" aria-hidden="true">
          <path d="M10 82c14-3 23-11 27-24 4-13 11-23 22-28 8-4 18-5 31-2-11 5-19 13-24 24-4 8-6 17-14 22-7 5-17 8-30 8-5 0-9 0-12 0z"></path>
          <path d="M18 70c10-8 18-20 23-34 3 9 8 16 15 20-7 3-13 8-18 14-6 7-12 7-20 0z"></path>
        </svg>

        <div id="authState" class="soft-fade relative z-10 mx-auto max-w-2xl">
          <p class="typewriter text-center text-xs uppercase tracking-[0.24em] text-[#66472b] sm:text-sm">
            Access Verification
          </p>
          <h1 class="mt-4 text-center text-3xl font-semibold leading-tight text-[#2f2418] sm:text-4xl">
            Sealed Letter Archive
          </h1>
          <p class="mx-auto mt-4 max-w-xl text-center text-sm text-[#4e3822] sm:text-base">
            Request a one-time passcode to Telegram, then enter it below to unseal this letter.
          </p>

          <form id="otpForm" class="mx-auto mt-8 flex max-w-md flex-col gap-4">
            <label for="otpInput" class="typewriter text-xs uppercase tracking-[0.18em] text-[#5a3f24]">
              One-time Password (OTP)
            </label>
            <input
              id="otpInput"
              type="text"
              inputmode="numeric"
              maxlength="6"
              placeholder="••••••"
              class="w-full rounded-md border border-[#8f6a3f] bg-[#f6ebd1]/85 px-4 py-3 text-center text-xl tracking-[0.4em] text-[#352414] outline-none transition focus:border-[#5f3c1f] focus:ring-2 focus:ring-[#9f7b52]/40"
              required
            />
            <button
              id="requestOtpButton"
              type="button"
              class="typewriter rounded-md border border-[#6f4b28] bg-[#8a643f] px-4 py-2.5 text-xs uppercase tracking-[0.18em] text-[#f4e7ca] transition hover:bg-[#6a4829] disabled:cursor-not-allowed disabled:opacity-60"
            >
              Send OTP to Telegram
            </button>
            <button
              id="unlockButton"
              type="submit"
              class="typewriter rounded-md border border-[#6f4b28] bg-[#79532f] px-4 py-2.5 text-sm uppercase tracking-[0.18em] text-[#f4e7ca] transition hover:bg-[#5c3d22] disabled:cursor-not-allowed disabled:opacity-60"
              disabled
            >
              Verify & Reveal
            </button>
            <p id="statusMsg" class="min-h-[1.4rem] text-center text-sm text-[#613f21]"></p>
          </form>
        </div>

        <article id="letterState" class="relative z-10 mx-auto hidden max-w-3xl opacity-0">
          <p class="typewriter text-center text-xs uppercase tracking-[0.24em] text-[#66472b] sm:text-sm">
            Unsealed Correspondence
          </p>
          <h2 class="mt-4 text-center text-2xl font-semibold text-[#2f2418] sm:text-3xl">
            Your Vintage Letter
          </h2>

          <section
            id="letterContent"
            class="mt-7 min-h-[340px] rounded-md border border-dashed border-[#7a5934] bg-[#f2e2be]/55 p-4 text-[1.03rem] leading-7 text-[#2e2218] shadow-inner sm:p-6"
          >
            <p class="typewriter text-sm uppercase tracking-[0.16em] text-[#6d4e2e]">[ LETTER CONTENT START ]</p>
            <p class="mt-4">
Hie Anjula,

They say that the finest stories are never truly written; they are lived, breath by breath, in the quiet spaces between two people. As I sit here trying to capture the gravity of what I feel, I realized that a simple message could never contain it. It needed a sanctuary—a digital parchment where time slows down, just like it does when I am with you.

There is a specific kind of alchemy that happens the moment we are in the same room. The world outside, with all its noise, its frantic pace, and its sharp edges, seems to lose its power. When I am with you, I feel a sense of groundedness that I haven't found anywhere else. It isn’t just that you are kind or that you listen; it’s the way your energy settles mine. You are my favorite kind of silence and my most cherished conversation. Whether we are sharing a laugh that leaves us breathless or sitting in a comfortable quiet, I feel an overwhelming sense of "home." It is a rare gift to find someone who makes the present moment feel like exactly where you are supposed to be.

But the magic doesn't end when we part ways. Even in the spaces between our meetings, you have this incredible way of reaching through the distance. I want you to know a secret: there is a distinct, rhythmic skip my heart takes every single time your name illuminates my screen. In a world of endless notifications and digital clutter, your text is the only one that carries weight. It’s a spark of electricity—a sudden, warm glow that tells me I am thought of by the person I think of most.

Whether it is a simple "hello," a shared joke, or a long story about your day, seeing your name pop up is the highlight of my waking hours. It’s more than just a message; it’s a bridge. It’s a reminder that even when the day is heavy, there is a light waiting for me at the other end of a signal. I find myself smiling at my phone like a fool, oblivious to the world around me, because in that moment, it’s just us.            </p>
            <p class="mt-4">
Anjula, you have become the melody to my daily rhythm. I built this space—this digital "old-school" letter—because something as special as you deserves more than a temporary chat bubble. You deserve the permanence of a story. You are the grace in my chaos, the clarity in my confusion, and the person who makes every tomorrow look a little brighter.

As you read this, know that every word is etched with sincerity. You aren't just a part of my life; you are the part that makes the rest of it make sense.

With all that I am,

Adi           </p>
            <p class="mt-8 typewriter text-sm uppercase tracking-[0.16em] text-[#6d4e2e]">[ LETTER CONTENT END ]</p>
          </section>
        </article>
      </section>
    </main>

    <audio id="bgAudio" loop preload="auto" src="https://assets.mixkit.co/music/preview/mixkit-lost-in-dreams-abstract-chill-3101.mp3"></audio>

    <script>
      const otpForm = document.getElementById("otpForm");
      const otpInput = document.getElementById("otpInput");
      const statusMsg = document.getElementById("statusMsg");
      const authState = document.getElementById("authState");
      const letterState = document.getElementById("letterState");
      const muteToggle = document.getElementById("muteToggle");
      const bgAudio = document.getElementById("bgAudio");
      const unlockButton = document.getElementById("unlockButton");
      const requestOtpButton = document.getElementById("requestOtpButton");

      let isMuted = false;
      let otpSessionId = "";
      bgAudio.volume = 0.32;

      async function verifyOTP(code) {
        if (!otpSessionId) {
          throw new Error("Request OTP first.");
        }

        const response = await fetch("/api/verify-telegram-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code, sessionId: otpSessionId })
        });
        const data = await response.json();

        if (!response.ok || !data.valid) {
          throw new Error(data.message || "Invalid OTP. Please try again.");
        }

        return true;
      }

      async function requestOTP() {
        statusMsg.textContent = "Sending OTP to Telegram...";
        requestOtpButton.disabled = true;
        unlockButton.disabled = true;
        otpSessionId = "";

        try {
          const response = await fetch("/api/request-otp", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({})
          });
          const data = await response.json();

          if (!response.ok || !data.ok || !data.sessionId) {
            throw new Error(data.message || "Failed to send OTP.");
          }

          otpSessionId = data.sessionId;
          statusMsg.textContent = "OTP sent to Telegram. Enter it to unlock the letter.";
          unlockButton.disabled = false;
          otpInput.focus();
        } catch (error) {
          statusMsg.textContent = error.message || "Could not request OTP.";
        } finally {
          requestOtpButton.disabled = false;
        }
      }

      function setMuteLabel() {
        muteToggle.textContent = isMuted ? "Unmute" : "Mute";
        muteToggle.setAttribute("aria-pressed", String(isMuted));
      }

      async function startAudio() {
        if (isMuted) return;
        try {
          await bgAudio.play();
        } catch (error) {
          statusMsg.textContent = "Audio is ready. Tap Unmute to start playback.";
        }
      }

      async function revealLetter() {
        authState.classList.add("hidden");
        letterState.classList.remove("hidden", "opacity-0");
        letterState.classList.add("reveal");
        muteToggle.classList.remove("hidden-until-auth");
        await startAudio();
      }

      otpForm.addEventListener("submit", async (event) => {
        event.preventDefault();

        const code = otpInput.value.trim();
        if (!otpSessionId) {
          statusMsg.textContent = "Request OTP first, then verify.";
          return;
        }

        statusMsg.textContent = "Verifying OTP...";
        unlockButton.disabled = true;
        requestOtpButton.disabled = true;

        try {
          const isValid = await verifyOTP(code);

          if (!isValid) {
            statusMsg.textContent = "Invalid OTP. Please try again.";
            unlockButton.disabled = false;
            return;
          }

          statusMsg.textContent = "Access granted. Revealing letter...";
          otpSessionId = "";
          await revealLetter();
        } catch (error) {
          statusMsg.textContent = error.message || "Verification failed. Please retry.";
          unlockButton.disabled = false;
          requestOtpButton.disabled = false;
        }
      });

      requestOtpButton.addEventListener("click", async () => {
        await requestOTP();
      });

      otpInput.addEventListener("input", () => {
        otpInput.value = otpInput.value.replace(/\D/g, "").slice(0, 6);
      });

      muteToggle.addEventListener("click", async () => {
        isMuted = !isMuted;
        bgAudio.muted = isMuted;

        if (isMuted) {
          bgAudio.pause();
        } else {
          try {
            await bgAudio.play();
          } catch (error) {
            statusMsg.textContent = "Tap the letter area once, then press Unmute again.";
          }
        }

        setMuteLabel();
      });

      setMuteLabel();
    </script>
  </body>
</html>
